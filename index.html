<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Loading...</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- The Google Fonts link will be dynamically added here -->
    <style>
      /* The font-family will be dynamically set here */
      .modal-open {
        overflow: hidden;
      }
      .modal-backdrop {
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
      }
      .grid-photo {
        transition: opacity 0.3s ease;
      }
      .grid-photo:hover {
        opacity: 0.85;
      }
    </style>
  </head>
  <body class="text-gray-800">
    <!-- Main Content -->
    <div class="pb-20">
      <main
        id="photo-grid"
        class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5"
      ></main>
    </div>

    <!-- Footer -->
    <footer
      class="fixed bottom-0 left-0 w-full bg-white/80 backdrop-blur-sm border-t border-gray-200"
    >
      <div
        class="container mx-auto px-4 py-3 flex justify-between items-center text-sm"
      >
        <div id="social-links" class="flex items-center space-x-4"></div>
        <div class="flex items-center space-x-4">
          <span id="photographer-name" class="text-gray-600"></span>
          <div id="footer-links" class="flex items-center space-x-4"></div>
        </div>
      </div>
    </footer>

    <!-- Modals -->
    <div
      id="image-modal"
      class="hidden fixed inset-0 z-50 items-center justify-center"
    >
      <div class="fixed inset-0 bg-black/50 modal-backdrop"></div>
      <div
        class="relative z-10 p-4 w-full max-w-4xl max-h-full flex flex-col items-center"
      >
        <button
          id="close-image-modal-btn"
          class="absolute top-0 right-0 md:-right-4 text-white text-4xl font-bold"
        >
          &times;
        </button>
        <div class="w-full h-auto flex flex-col items-center">
          <img
            id="modal-img"
            src=""
            alt="Focused view"
            class="max-w-full max-h-[80vh] object-contain shadow-2xl"
          />
          <p
            id="modal-caption"
            class="text-white text-center mt-4 text-lg bg-black/30 px-4 py-2 rounded-md"
          ></p>
        </div>
      </div>
    </div>
    <div
      id="about-modal"
      class="hidden fixed inset-0 z-50 items-center justify-center"
    >
      <div class="fixed inset-0 bg-black/50 modal-backdrop"></div>
      <div
        class="relative z-10 bg-white rounded-lg shadow-xl w-full max-w-lg p-6 m-4"
      >
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-2xl font-bold">About</h2>
          <button
            id="close-about-modal-btn"
            class="text-gray-500 hover:text-gray-800 text-3xl leading-none"
          >
            &times;
          </button>
        </div>
        <div
          id="about-modal-content"
          class="text-gray-600 prose max-w-none"
        ></div>
      </div>
    </div>

    <script>
      const socialIconMap = {
        twitter: `<svg class="h-5 w-5" fill="currentColor" viewBox="0 0 24 24"><path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.223.085a4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/></svg>`,
        instagram: `<svg class="h-5 w-5" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.85s-.011 3.584-.069 4.85c-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07s-3.584-.012-4.85-.07c-3.252-.148-4.771-1.691-4.919-4.919-.058-1.265-.069-1.645-.069-4.85s.011-3.584.069-4.85c.149-3.225 1.664-4.771 4.919-4.919C8.416 2.175 8.796 2.163 12 2.163zm0 1.441c-3.117 0-3.486.01-4.714.066-2.815.128-3.922 1.229-4.05 4.05C3.201 8.936 3.19 9.31 3.19 12s.011 3.064.066 4.286c.128 2.821 1.235 3.922 4.05 4.05 1.228.056 1.597.066 4.714.066s3.486-.01 4.714-.066c2.815-.128 3.922-1.229 4.05-4.05.055-1.222.066-1.596.066-4.286s-.011-3.064-.066-4.286c-.128-2.821-1.235-3.922-4.05-4.05C15.486 3.613 15.117 3.604 12 3.604zM12 8.25a3.75 3.75 0 100 7.5 3.75 3.75 0 000-7.5zm0 1.441a2.31 2.31 0 110 4.62 2.31 2.31 0 010-4.62zM16.802 6.11a1.096 1.096 0 100 2.192 1.096 1.096 0 000-2.192z"/></svg>`,
        email: `<svg class="h-5 w-5" fill="currentColor" viewBox="0 0 24 24"><path d="M22 6c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6zm-2 0l-8 5-8-5h16zm0 12H4V8l8 5 8-5v10z"/></svg>`,
      };

      function applyConfig(config) {
        // Apply Font Settings
        if (config.fontUrl) {
          const link = document.createElement("link");
          link.href = config.fontUrl;
          link.rel = "stylesheet";
          document.head.appendChild(link);
        }
        if (config.fontFamily) {
          document.body.style.fontFamily = config.fontFamily;
        }

        // Apply other settings
        document.title = config.siteTitle;
        document.getElementById("photographer-name").textContent =
          config.photographerName;

        const footerLinksContainer = document.getElementById("footer-links");
        footerLinksContainer.innerHTML = "";
        if (Array.isArray(config.footerLinks)) {
          config.footerLinks.forEach((link) => {
            const a = document.createElement("a");
            a.href = link.url;
            a.textContent = link.text;
            a.className = "text-gray-600 hover:text-gray-900 transition-colors";
            if (link.url === "#about") a.dataset.action = "open-about";
            footerLinksContainer.appendChild(a);
          });
        }

        const socialLinksContainer = document.getElementById("social-links");
        socialLinksContainer.innerHTML = "";
        if (Array.isArray(config.socialLinks)) {
          config.socialLinks.forEach((link) => {
            const a = document.createElement("a");
            a.href = link.url;
            a.title = link.name;
            a.className = "text-gray-500 hover:text-gray-800 transition-colors";
            a.innerHTML = socialIconMap[link.name] || "";
            if (link.name !== "email") a.target = "_blank";
            socialLinksContainer.appendChild(a);
          });
        }

        document.getElementById("about-modal-content").innerHTML =
          config.aboutText || "";
      }

      function getHomepagePhotos(portfolioData) {
        const homepagePhotos = [];
        for (const albumName in portfolioData) {
          const homePhotosInAlbum = portfolioData[albumName].filter((photo) =>
            photo.name.startsWith("home_")
          );
          homePhotosInAlbum.forEach((photo) =>
            homepagePhotos.push({ ...photo, albumName })
          );
        }
        return homepagePhotos;
      }

      function populateGrid(photos) {
        const photoGrid = document.getElementById("photo-grid");
        photos.forEach((photo) => {
          const photoContainer = document.createElement("div");
          photoContainer.className =
            "w-full aspect-square bg-gray-200 overflow-hidden cursor-pointer";
          const img = document.createElement("img");
          img.src = photo.src;
          img.alt = photo.caption;
          img.className = "w-full h-full object-cover grid-photo";
          img.dataset.caption = photo.caption;
          img.dataset.albumName = photo.albumName;
          photoContainer.appendChild(img);
          photoGrid.appendChild(photoContainer);
        });
      }

      function openImageModal(src, caption, albumName) {
        document.getElementById("modal-img").src = src;
        document.getElementById("modal-img").alt = caption;
        const albumUrl = `album-detail.html?album=${encodeURIComponent(
          albumName
        )}`;
        document.getElementById(
          "modal-caption"
        ).innerHTML = `<a href="${albumUrl}" class="hover:underline">${caption}</a>`;
        document.getElementById("image-modal").classList.remove("hidden");
        document.getElementById("image-modal").classList.add("flex");
        document.body.classList.add("modal-open");
      }

      function setupEventListeners() {
        const imageModal = document.getElementById("image-modal");
        const aboutModal = document.getElementById("about-modal");
        const closeAllModals = () => {
          imageModal.classList.add("hidden");
          aboutModal.classList.add("hidden");
          document.body.classList.remove("modal-open");
        };
        document
          .getElementById("close-image-modal-btn")
          .addEventListener("click", closeAllModals);
        document
          .getElementById("close-about-modal-btn")
          .addEventListener("click", closeAllModals);
        document
          .querySelectorAll(".modal-backdrop")
          .forEach((backdrop) =>
            backdrop.addEventListener("click", closeAllModals)
          );
        document.body.addEventListener("click", (e) => {
          if (e.target.dataset.action === "open-about") {
            e.preventDefault();
            aboutModal.classList.remove("hidden");
            aboutModal.classList.add("flex");
            document.body.classList.add("modal-open");
          }
          if (e.target.closest(".grid-photo")) {
            const img = e.target.closest(".grid-photo");
            openImageModal(img.src, img.dataset.caption, img.dataset.albumName);
          }
        });
      }

      document.addEventListener("DOMContentLoaded", () => {
        Promise.all([
          fetch("./config.json").then((res) => res.json()),
          fetch("./portfolio-data.json").then((res) => res.json()),
        ])
          .then(([configData, portfolioData]) => {
            applyConfig(configData);
            const homepagePhotos = getHomepagePhotos(portfolioData);
            populateGrid(homepagePhotos);
            setupEventListeners();
          })
          .catch((error) => {
            console.error("Error loading site data:", error);
            document.body.innerHTML = `<p class="text-red-500 text-center p-8"><strong>Error:</strong> Could not load site data.</p>`;
          });
      });
    </script>
  </body>
</html>
